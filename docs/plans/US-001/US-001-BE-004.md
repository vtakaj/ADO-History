# US-001-BE-004: チケット詳細情報取得機能実装

## Task Overview
各チケットの詳細情報（作成日、タイプ、優先度、説明など）を取得し、履歴データと統合する機能を実装する。

## Acceptance Criteria
- [x] チケット詳細情報の取得
- [x] 作成日時と最終更新日時の記録
- [x] チケットタイプ（Bug, Task, User Story等）の取得
- [x] 優先度情報の取得
- [x] 作業見積もり時間の取得（存在する場合）
- [x] チケット詳細とステータス履歴の統合
- [x] 詳細情報のJSON形式での保存

## Technical Requirements
- Work Item Details API の使用
- フィールド展開（$expand パラメータ）の活用
- 必要フィールドのみの取得（性能最適化）
- NULL値やデフォルト値の適切な処理

## Implementation Details
```bash
# 実装対象関数
get_workitem_details() {
    local workitem_id="$1"
    
    # Work Item API呼び出し
    # 詳細フィールドの取得
    # NULL値の処理
}

merge_workitem_data() {
    # 基本情報と詳細情報の統合
    # 履歴データとの関連付け
}

fetch_all_details() {
    # 全チケットの詳細取得
    # バッチ処理最適化
}
```

## API Endpoints
- GET `https://dev.azure.com/{organization}/{project}/_apis/wit/workitems/{id}`
- Query parameters: `api-version=7.2`, `$expand=fields`

## Target Fields
- System.CreatedDate
- System.ChangedDate
- System.WorkItemType
- Microsoft.VSTS.Common.Priority
- Microsoft.VSTS.Scheduling.OriginalEstimate
- System.Description (optional)

## Data Structure
```json
{
  "workitem_details": [
    {
      "id": 123,
      "title": "Sample Work Item",
      "type": "User Story",
      "priority": 2,
      "createdDate": "2025-01-10T10:00:00+09:00",
      "lastModifiedDate": "2025-01-15T19:30:00+09:00",
      "originalEstimate": 8.0,
      "assignedTo": "user@domain.com",
      "currentStatus": "Active"
    }
  ]
}
```

## Performance Optimization
```bash
# バッチ処理による効率化
BATCH_SIZE=50
process_in_batches() {
    # 50件ずつ処理
    # API レート制限対応
    # 進捗表示
}
```

## Implementation Status
✅ **完了** - 2025-01-25

### 実装内容
- `get_workitem_details()`: Work Item詳細API呼び出し
- `merge_workitem_data()`: 基本情報と詳細情報の統合処理
- `fetch_all_details()`: 全Work Itemsの詳細情報バッチ取得
- `cmd_fetch_details()`: fetch-detailsコマンド実装

### オプション機能として実装
詳細情報の取得は通常利用では使わないオプション機能として実装：
- **fetch コマンド**: デフォルトでは基本情報とステータス履歴のみ取得
- **--with-details オプション**: 必要時のみ詳細情報も取得
- **fetch-details コマンド**: 詳細情報のみを単独取得

### コマンド例
```bash
# 基本情報のみ（高速）
./ado-tracker.sh fetch MyProject 30

# 詳細情報も含む（必要時のみ）
./ado-tracker.sh fetch MyProject 30 --with-details

# 詳細情報のみ
./ado-tracker.sh fetch-details MyProject
```

## Definition of Done
- [x] 全チケットの詳細情報が取得される
- [x] 作成日時・更新日時が正確に記録される
- [x] チケットタイプと優先度が正しく取得される
- [x] 詳細データがworkitem_details.jsonに保存される
- [x] 基本情報と詳細情報が適切に統合される
- [x] オプション機能としてパフォーマンスを考慮した実装
- [x] テストスイート完備
- [x] ドキュメント更新完了

## Dependencies
- US-001-BE-002 (チケット一覧)
- US-001-INF-002 (データ管理)

## Estimated Effort
2-3 hours

## Testing Strategy
- 異なるタイプのチケット（Bug, Task, User Story）での確認
- フィールドが未設定のチケットでの動作確認
- 大量チケットでの性能確認
- データ統合の正確性確認