# US-001-BE-003: チケットステータス変更履歴取得機能実装

## Task Overview
各チケットのステータス変更履歴を取得し、変更日時、変更前後のステータス、変更者情報を抽出する機能を実装する。

## Acceptance Criteria
- [ ] 各チケットのUpdates履歴取得
- [ ] ステータス変更のみをフィルタリング
- [ ] 変更日時（日本時間）の正確な記録
- [ ] 変更前ステータスと変更後ステータスの取得
- [ ] 変更者（ユーザー）情報の取得
- [ ] 履歴データのJSON形式での保存
- [ ] 履歴取得の進捗表示

## Technical Requirements
- Work Item Updates API の使用
- 日時のタイムゾーン変換（UTC → JST）
- ステータスフィールド変更の検出
- バッチ処理（複数チケットの履歴取得）
- 進捗表示（処理中チケット数の表示）

## Implementation Details
```bash
# 実装対象関数
get_workitem_updates() {
    local workitem_id="$1"
    
    # Updates API呼び出し
    # ステータス変更のフィルタリング
    # 日時変換処理
}

extract_status_changes() {
    # ステータス変更の抽出
    # 変更前後の値取得
    # 変更者情報の取得
}

fetch_all_status_history() {
    # 全チケットの履歴取得
    # 進捗表示
    # バッチ処理
}
```

## API Endpoints
- GET `https://dev.azure.com/{organization}/{project}/_apis/wit/workitems/{id}/updates`
- Query parameters: `api-version=7.2`

## Data Structure
```json
{
  "status_history": [
    {
      "workitemId": 123,
      "changeDate": "2025-01-15T19:30:00+09:00",
      "changedBy": "user@domain.com",
      "previousStatus": "New",
      "newStatus": "Active",
      "revision": 5
    }
  ]
}
```

## Time Zone Handling
```bash
# UTC to JST conversion
convert_to_jst() {
    local utc_time="$1"
    date -d "$utc_time +9 hours" '+%Y-%m-%dT%H:%M:%S+09:00'
}
```

## Definition of Done
- 全チケットのステータス変更履歴が正確に取得される
- 日時が日本時間で正しく記録される
- 変更前後のステータスが正確に記録される
- 履歴データがstatus_history.jsonに保存される
- 95%以上の精度でステータス変更を抽出できる

## Dependencies
- US-001-BE-002 (チケット一覧)
- US-001-INF-002 (データ管理)

## Estimated Effort
3 hours

## Testing Strategy
- 複数回ステータス変更されたチケットでの確認
- 大量履歴データでの性能確認
- タイムゾーン変換の正確性確認
- ステータス以外の変更がフィルタリングされることの確認